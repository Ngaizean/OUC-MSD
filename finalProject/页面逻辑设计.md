## 启动页

### 动作

1. 首先先获取该用户的`openid`, 如果在数据库中没有找到对应的用户注册信息, 弹窗获取提醒获取用户的微信昵称和微信头像.
2. 点击==开始旅程==跳转==广场==主页

### 涉及的数据

- `_openid`
- 用户的昵称`username`
- 用户的头像的云储存地址`pic_address`

### 2.0迭代功能

- 支持获取自定义的昵称和头像

## 广场页

### 动作

1. 点击任意条目上的任意区域可以实现跳转该条目下的==详情页==
   - 这意味着每一个条目的组件都必须要有一个单独的`index`, 这个`index`和数据库返回的数组的下标对应
   - 跳转时, 使用`url`传参的方式, 传入`index`

### 涉及的数据

- 起点`begin_place`
- 终点`end_place`
- 出发日期`date`
- 出发时间`time`

### 2.0迭代功能

- 支持只显示今天往后日期的的条目
- 不显示已经取消/满员的条目

### 3.0迭代功能

- 支持广场的搜索功能

## 详情页

### 动作

1. 上一个画面传入`index`, 这个画面接收后, 在数据库中进行查询, 并加载对应的数据.
2. 右上角有更多选项, 支持收藏和退出/取消订单
   - 一旦退出则参与者发生变化, 一旦参与者为0, 则弹窗提示订单将取消
3. ==实时拼车按钮==在拼车时间的前1个小时开放, 用户点击该按钮后进入==实时拼车页面==, 同样传入对应的条目`id`参数
   - 如果订单为已结束, 则两个按钮都不可用
4. 加入和退出共用一个按钮, 已加入就显示退出按钮, 反之显示加入按钮. 无论是哪个按钮点击后应该有弹窗提示是否将操作继续.
   - 因此需要检索用户在这个条目下的状态, 或者说该条目的数据有没有这个用户参与

### 涉及的数据

- 起点`begin_place`
- 终点`end_place`
- 出发日期`date`
- 出发时间`time`
- 剩余车位`rest_seat`
- 备注`text`
- 参与人`passenger`
- 订单状态`status`
- 用户收藏列表`favorite`
- 用户创建订单的列表`create`

### 2.0迭代功能

- 支持参与者头像出现
- 如果该订单是自己创建的, 支持退出和取消

## 实时拼车页

### 动作

0. 根据传入的`id`查询数据库并进行加载数据

1. 隔一会就查询数据库, 更新是否有成员上传了车辆信息, 成员的签到情况. 即支持上传车辆信息图片
2. 签到框内为参与者的用户名+状态(红绿)

3. 点击签到, 对应的状态变绿, 随之签到按钮不可用, 并执行刷新.
4. 点击结束, 弹窗提示是否要退出. 退出后该用户此时对该条目的状态为已经结束, 不允许进入实时拼车页面.
   - 该订单从开始时间开始计时 5h 后自动变为已结束
   - 如果所有用户已结束 则直接变为已结束.

### 涉及的数据

- 车辆信息`carinfo`
- 用户电话号码`phone`
- 订单状态`status`

### 2.0迭代功能

- 支持呼叫未签到用户
- 实现微信的共享位置的接口

## 发布页

### 动作

1. 免责声明未勾选则无法点击发布
2. 点击发布后弹窗提醒成功或是失败, 并重新刷新该页面.
   - 点击后提交数据库,这是订单最先创建的时刻, 要把所有的可能的属性都应该初始化
   - 还要弹窗提醒一旦发布不可更改 只能通过取消订单重新创建

### 涉及的数据

- 用户姓名`realname`
- 用户手机号`phone`
- 起点`begin_place`
- 终点`end_place`
- 出发日期`date`
- 出发时间`time`
- 剩余车位`rest_seat`
- 备注`text`

## 我的页

### 动作

1. 包含四个板块, 头像和昵称板块, ==我的发布==, ==我的收藏==. 后面三者对应三个页面.

### 2.0迭代版本

- 支持点击头像和昵称进行更换
- 新增设置
  - 支持注销/退出登录

### 3.0迭代版本

- 支持==全部记录==页面

## 我的发布页 / 我的收藏页

### 动作

1. 使用云函数获取用户的`openid`, 根据该数据找到对应的用户信息, 根据用户信息中储存该用户发布的订单, 寻找对应数据库中的订单. 并进行列表加载. 设计的页面和模式和广场页类似

2. 点击任何一个条目上的任何一个区域都将跳转到相应的详情页, 复制详情页即可.

### 涉及的数据

- 用户的发布列表`create`



## 数据库设计

### 订单数据库

- 用户标识符`_openid`
- 订单标识符`_id`

- 起点`begin_place`
- 终点`end_place`
- 出发日期`date`
- 出发时间`time`
- 剩余车位`rest_seat`
- 备注`text`
- 参与人`passenger`
- 订单状态`status`
- 车辆信息`carinfo`
- 用户电话号码`phone`

### 用户数据库

- 用户小程序标识符`_openid`
- 用户标识符`_id`
- 用户的昵称`username`
- 用户的头像的云储存地址`pic_address`
- 用户收藏列表`favorite`
- 用户创建订单的列表`create`
- 用户电话`phone`
